---
title: Monitors cpu, memory, specified process, and disk automatically using scrips
author: kmlee
date: 2023-08-16 16:30:00 +9
categories: [Blogging, Demo]
tags: [scripts]
---

매 2시간마다 자동으로 아래 기능들을 실행한다.

    1. CPU 사용량 모니터링:
        현재 CPU 사용률을 퍼센트로 출력한다.
        CPU 사용률이 80% 이상일 경우, 경고 메시지를 출력한다.
    
    2. 메모리 사용량 모니터링:
        현재 사용 중인 RAM과 총 RAM을 출력한다.
        사용 가능한 RAM이 총 RAM의 20% 미만일 경우, 경고 메시지를 출력한다.
    
    3. 특정 프로세스 모니터링:
        '[project directory]/config' 파일에 모니터링할 파일들의 PID를 작성한다.
        해당 프로세스가 실행 중인지 확인하고, 그 상태(실행 중/실행되지 않음)메시지를 출력한다.
    
    4. 디스크 사용량 모니터링:
        각 마운트된 파티션의 사용량을 퍼센트로 출력한다.
        특정 파티션의 사용량이 90% 이상일 경우, 경고 메시지를 출력한다.

메시지 출력 '[project directory]/log' 에 저장하며,
경고 발생 시 사용자 표준출력에 표시한다.

구현 과정
======================================
첫번째 기능을 구현하기 위해 cpu 사용량과 관련된 명령, 혹은 시스템 파일에 대해 검색해보았다.
    '/proc/log'파일 내용 혹은 '$lscpu'명령의 출력 상에서는 cpu spec에 대해서는 자세히 소개해주지만, cpu가 현재 진행 중인 작업 정보는 알 수 없다. 따라서 해당 방법은 사용할 수 없다.
    '$mpstat' 명령을 통해 아래와 같이 cpu 사용량을 쉽게 파악할 수 있다. 메뉴얼에 따르면, %idle 영역은 cpu의 유휴한 시간 백분율을 나타낸다고 나와있다. 따라서 100에서 %idle 영역의 값을 빼주면 가용중인 cpu 사용량을 계산할 수 있다고 하겠다. 하지만 mpstat 명령어는 리눅스 기본명령어에 포함되지 않으며 'sysstat' 패키지의 일부로 제공되는 명령어이다. 본 스크립트 구현의 제한조건에 따라서 해당 방법 또한 사용할 수 없다.
    ![result_command_mpstat](https://github.com/yesleekm/yesleekm.github.io/assets/54760524/4777ca5f-6ea1-4015-bdfd-b3133fc01407)
    ![manual_command_mpstat_idle](https://github.com/yesleekm/yesleekm.github.io/assets/54760524/dcf623fa-bfe2-4ee4-b91e-cc7747b579e3)
    '$top' 명령을 통해 프로세스 정보를 실시간으로 터미널에 출력할 수 있는데, 해당 정보는 아래와 같이 나타난다.
    ![result_command_top](https://github.com/yesleekm/yesleekm.github.io/assets/54760524/63675bf2-4d7e-42d2-88ff-64d7ca0bb280)